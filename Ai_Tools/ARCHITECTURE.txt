################################################################################
#                    OCEAN HUNTER V10.8.2 â€” COMPLETE SECURE ARCHITECTURE       #
#           SPOT SWING TRADING | 5 ALTCOINS â†’ BTC + PAXG ACCUMULATION          #
#                     Date: 1404/10/09 | 2025-12-30                            #
#                                                                              #
#   STATUS: FINAL & LOCKED | CAPITAL: PERCENTAGE-BASED | SECURITY: MAXIMUM    #
#   REFERENCE: REF-ARCH-V10.8.2-FINAL-LOCK-610                                 #
################################################################################

================================================================================
SECTION 1 â€” CAPITAL ALLOCATION & ASSET ROLES
================================================================================

[1.1] Capital Model: PERCENTAGE-BASED (Scalable)
    - Minimum Required: 500 USDT
    - No Maximum Limit
    - All calculations use percentages, not fixed amounts

[1.2] Asset Allocation Table:

    +------------+---------+---------------------------------------------+
    | Asset      | Percent | Role                                        |
    +------------+---------+---------------------------------------------+
    | SOL        | 25%     | Primary Swing Target                        |
    | BNB        | 20%     | Secondary Swing Target                      |
    | XRP        | 15%     | Tertiary Swing Target                       |
    | AVAX       | 10%     | Opportunity Target                          |
    | LINK       | 10%     | Opportunity Target                          |
    | USDT       | 10%     | Operating Reserve (DCA Fuel)                |
    | BTC        | 5%      | Growth Vault (Profit Destination)           |
    | PAXG       | 5%      | Smart Vault (Safe Haven + Refuel)           |
    +------------+---------+---------------------------------------------+
    | TOTAL      | 100%    |                                             |
    +------------+---------+---------------------------------------------+

[1.3] Golden Flow of Capital:

    USDT --> Buy Altcoin --> Sell with Profit --> Profit Router --> BTC/PAXG
                          --> Principal returns to USDT Pool

[1.4] Core Safety Rules:

    [X] NO STOP-LOSS (DCA replaces cutting losses)
    [X] NO LEVERAGE (Spot only)
    [X] NO ETH (Focus on faster alts)
    [V] PAXG = Last line of defense (Emergency Refuel)

================================================================================
SECTION 2 â€” STRATEGY LOGIC: SMART SNIPER
================================================================================

[2.1] Timeframes:
    - Analysis: M15 (candle close)
    - Safety Checks: Real-time / 60s

[2.2] Entry Logic (Score >= 70 to Enter):

    +--------------------+------------------------------------+--------+
    | Factor             | Condition                          | Points |
    +--------------------+------------------------------------+--------+
    | Technical          | RSI(14) < 35 AND Price < BB_Lower  | 35     |
    | Order Book (OBI)   | Bid Volume > Ask Volume (Top 20)   | 15     |
    | Volume Spike       | Volume > 1.5 x SMA(20)             | 25     |
    | Momentum           | Green Candle (Close > Open)        | 25     |
    +--------------------+------------------------------------+--------+
    | TOTAL POSSIBLE     |                                    | 100    |
    +--------------------+------------------------------------+--------+

    NOTE: OBI weight reduced to 15 (was 30) due to Nobitex manipulation risk

[2.3] Exit Logic:
    - Take Profit: 1.5% - 3% (Dynamic based on momentum)
    - Trailing Stop: Activates after +1% profit

[2.4] DCA Layers (If Position Goes Against):

    +-------+---------------+----------------+-----------------+
    | Layer | Trigger       | Add Amount     | New Avg Target  |
    +-------+---------------+----------------+-----------------+
    | L1    | -3% from Avg  | +50% Position  | Reduce by ~1.5% |
    | L2    | -6% from Avg  | +75% Position  | Reduce by ~2.5% |
    | L3    | -10% from Avg | +100% Position | Reduce by ~4%   |
    +-------+---------------+----------------+-----------------+

[2.5] NOBITEX API SPECIFICATIONS:

    [2.5.1] Rate Limits:
        - Private API: 30 requests/minute (HARD LIMIT)
        - Implementation: Use 25 req/min with 2.5s spacing

    [2.5.2] Order Constraints:
        - Minimum Order: 10 USDT (Use 12 USDT buffer)
        - Order Types: "limit" and "market" ONLY
        - Precision: Fetch dynamically from GET /v2/options

    [2.5.3] Fee Structure:
        - Taker Fee: 0.35%
        - Maker Fee: 0.25%
        - Use 0.35% in all calculations (worst case)

    [2.5.4] Key Endpoints:

        +-----------------------------+----------------------------------+
        | Endpoint                    | Purpose                          |
        +-----------------------------+----------------------------------+
        | GET /v2/wallets             | Fetch all balances               |
        | GET /v2/orderbook/{symbol}  | Order book for OBI calculation   |
        | GET /v2/trades/{symbol}     | Recent trades                    |
        | POST /market/orders/add     | Place new order                  |
        | POST /market/orders/cancel  | Cancel existing order            |
        | GET /v2/options             | Trading pairs info (precision)   |
        | GET /market/udf/history     | OHLCV candle data                |
        +-----------------------------+----------------------------------+

    [2.5.5] Authentication:
        - Header: Authorization: Token {API_KEY}

[2.6] POSITION LIMITS & QUEUE SYSTEM:

    [2.6.1] Concurrent Position Limit:
        MAX_CONCURRENT_POSITIONS = 3

    [2.6.2] Queue Management:
        - Signals scoring >= 70 but blocked â†’ Add to WAITING_QUEUE
        - Queue stores: {symbol, score, timestamp, price_at_signal}
        - Queue Expiry: 4 HOURS (signal becomes stale)
        - Max Queue Size: 5 signals

    [2.6.3] Queue Processing:
        WHEN position closes:
            CHECK WAITING_QUEUE
            FOR each queued signal (oldest first):
                IF not expired AND current_price <= price_at_signal * 1.01:
                    RE-EVALUATE score
                    IF score >= 70: EXECUTE
                ELSE:
                    DISCARD signal

    [2.6.4] Overexposure Protection:
        IF all 3 slots filled AND new signal score >= 85:
            LOG "High-conviction signal blocked"
            ALERT via Telegram
            ADD to priority queue

[2.7] BTC TREND FILTER (Entry Gate):

    BEFORE any new entry:
        CHECK BTC_HEALTH (from Section 3.1)
        IF BTC_HEALTH == "WEAK":
            BLOCK new entries completely
            LOG "Entry blocked: BTC in WEAK state"
            ALERT via Telegram
        IF BTC_HEALTH == "NEUTRAL" or "STRONG":
            ALLOW entry evaluation

[2.8] ORDER EXECUTION STRATEGY:

    [2.8.1] Primary Method: LIMIT ORDER
        - Price: Current price + 0.1% (for BUY)
        - Price: Current price - 0.1% (for SELL)
        - Timeout: 30 seconds

    [2.8.2] Fallback Method: MARKET ORDER
        IF Limit order not filled in 30 seconds:
            CANCEL limit order
            PLACE market order
            LOG "Fallback to market order"

    [2.8.3] Benefits:
        - Reduced slippage
        - Lower fees (Maker vs Taker)
        - Protection against price manipulation

================================================================================
SECTION 3 â€” PROFIT ROUTER V2.0 (DYNAMIC BTC/PAXG SPLIT)
================================================================================

[3.1] BTC Health Assessment (1H Timeframe):
    - Indicators: RSI(14), EMA(50), MACD(12,26,9)

    BTC_STRONG  = RSI > 60 AND Price > EMA(50) AND MACD > 0
    BTC_WEAK    = RSI < 40 AND Price < EMA(50) AND MACD < 0
    BTC_NEUTRAL = Everything else

[3.2] Profit Distribution Rules:

    +------------------+-----------------+-----------------+
    | BTC State        | To BTC Vault    | To PAXG Vault   |
    +------------------+-----------------+-----------------+
    | STRONG           | 80%             | 20%             |
    | NEUTRAL          | 50%             | 50%             |
    | WEAK             | 20%             | 80%             |
    +------------------+-----------------+-----------------+

[3.3] Profit Flow Example (100 USDT profit, NEUTRAL state):
    â†’ 50 USDT â†’ Buy BTC â†’ BTC Vault
    â†’ 50 USDT â†’ Buy PAXG â†’ PAXG Vault

================================================================================
SECTION 4 â€” EMERGENCY REFUEL PROTOCOL (PAXG â†’ USDT)
================================================================================

[4.1] Activation Conditions (ALL must be true):
    - DCA Layer 3 is active
    - USDT Pool < 20% of allocated slot capital
    - PAXG position is in PROFIT
    - Global Stop is NOT active

[4.2] Execution Limits:
    - Maximum sell: 50% of PAXG holdings
    - Cooldown: 24 hours between refuels

[4.3] WAIT MODE:
    IF PAXG is at loss when needed:
        PAUSE DCA execution
        WAIT for PAXG recovery
        ALERT "Waiting for PAXG profit to refuel"

[4.4] Refuel Flow:
    PAXG (profit) â†’ Sell 50% â†’ USDT â†’ Fund DCA Layer 3

================================================================================
SECTION 5 â€” WATCHDOG BELLE (System Health Monitor)
================================================================================

[5.1] Check Interval: Every 60 seconds

[5.2] Health Checks:

    +-----+---------------------------+------------------+------------------+
    | #   | Check                     | Warning          | Critical         |
    +-----+---------------------------+------------------+------------------+
    | 1   | API Response Time         | > 5 seconds      | > 10 seconds     |
    | 2   | Balance Sync              | > 1% mismatch    | > 5% mismatch    |
    | 3   | Position Drift            | > 2% from state  | > 5% from state  |
    | 4   | Memory Usage              | > 70%            | > 90%            |
    | 5   | Open Order Age            | > 30 minutes     | > 60 minutes     |
    | 6   | Last Successful Trade     | > 24 hours       | > 72 hours       |
    +-----+---------------------------+------------------+------------------+

[5.3] Actions:
    - Warning: Log + Continue
    - Critical: Log + Alert + Consider HALT

[5.4] External Heartbeat:
    - Send Telegram message every 30 MINUTES
    - Message includes: Status, Open Positions, USDT Balance, BTC Health
    - If no heartbeat received â†’ System may be down

================================================================================
SECTION 6 â€” TELEGRAM INTEGRATION
================================================================================

[6.1] Alert Levels:

    +----------+-------------------+----------------------------------------+
    | Level    | Emoji             | Use Case                               |
    +----------+-------------------+----------------------------------------+
    | INFO     | â„¹ï¸                | Trade opened, closed, status updates   |
    | WARNING  | âš ï¸                | DCA triggered, queue full, anomaly     |
    | CRITICAL | ğŸš¨                | Global stop, kill switch, system halt  |
    | SUCCESS  | âœ…                | Profitable trade, vault deposit        |
    +----------+-------------------+----------------------------------------+

[6.2] Commands:

    /status     â†’ Current positions, balances, mode
    /stop       â†’ Activate Global Stop
    /restart    â†’ Begin recovery protocol
    /report     â†’ Daily summary
    /mode       â†’ Show current trading mode
    /queue      â†’ Show waiting queue status
    /health     â†’ Show BTC health state

[6.3] Connection:
    - Use SOCKS5 proxy (127.0.0.1:1080) for Iran
    - Retry logic: 3 attempts with 5s delay
    - Fallback: Log locally if Telegram fails

[6.4] Security:
    - WHITELIST_CHAT_IDS: Only your chat ID allowed
    - Rate limit commands: 1 per 5 seconds
    - Critical commands require /confirm within 30 seconds

================================================================================
SECTION 7 â€” DATA FLOW DIAGRAM
================================================================================

    +------------------+
    |   Nobitex API    |
    +--------+---------+
             |
             v
    +--------+---------+
    |   Rate Limiter   | (25 req/min, 2.5s spacing)
    +--------+---------+
             |
             v
    +--------+---------+
    |  Data Processor  | (Candles, Order Book, Balances)
    +--------+---------+
             |
    +--------+--------+--------+
    |        |        |        |
    v        v        v        v
+-------+ +------+ +------+ +--------+
|Spread | |Wick  | |Volume| |Indicators|
|Filter | |Filter| |Check | |(RSI,BB) |
+---+---+ +--+---+ +--+---+ +----+----+
    |        |        |          |
    +--------+--------+----------+
             |
             v
    +--------+---------+
    |  Strategy Engine | (Score calculation)
    +--------+---------+
             |
             v
    +--------+---------+
    | Position Manager | (Max 3 + Queue)
    +--------+---------+
             |
             v
    +--------+---------+
    |  Order Executor  | (Limit first, Market fallback)
    +--------+---------+
             |
             v
    +--------+---------+
    |  Profit Router   | (BTC/PAXG split)
    +--------+---------+
             |
             v
    +--------+---------+
    |  State Manager   | (state.json + backup)
    +--------+---------+
             |
             v
    +--------+---------+
    |    Telegram      | (Alerts + Heartbeat)
    +------------------+
================================================================================
SECTION 8 â€” DIRECTORY STRUCTURE
================================================================================

OCEAN_HUNTER/
â”œâ”€â”€ main.py                     # Entry point + main loop
â”œâ”€â”€ config.py                   # All parameters & thresholds
â”œâ”€â”€ requirements.txt            # Python dependencies
â”œâ”€â”€ state.json                  # Persistent state (positions, balances)
â”œâ”€â”€ trades.xlsx                 # Trade history log
â”œâ”€â”€ .env                        # API keys (NEVER commit!)
â”œâ”€â”€ .gitignore                  # Git ignore rules
â”‚
â”œâ”€â”€ Ai_Tools/                   # AI Development Toolkit
â”‚   â”œâ”€â”€ setup_git.py            # Git repository initializer
â”‚   â”œâ”€â”€ build.py                # Auto-build script
â”‚   â”œâ”€â”€ context_gen.py          # Project context generator
â”‚   â”œâ”€â”€ WORKFLOW.txt            # Automation rules
â”‚   â””â”€â”€ ARCHITECTURE.txt        # This document (V10.8.2)
â”‚
â”œâ”€â”€ modules/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚
â”‚   â”œâ”€â”€ core/
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ engine.py           # Main trade cycle manager
â”‚   â”‚   â”œâ”€â”€ config_loader.py    # Load config & .env
â”‚   â”‚   â”œâ”€â”€ rate_limiter.py     # API rate limiting (25 req/min)
â”‚   â”‚   â”œâ”€â”€ state_manager.py    # Read/Write state.json + backup
â”‚   â”‚   â””â”€â”€ safety_manager.py   # Kill switch, mode gates, drawdown
â”‚   â”‚
â”‚   â”œâ”€â”€ network/
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ nobitex.py          # Exchange API wrapper
â”‚   â”‚   â””â”€â”€ telegram.py         # Alerts with SOCKS5 proxy
â”‚   â”‚
â”‚   â”œâ”€â”€ analysis/
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ indicators.py       # RSI, EMA, BB, MACD, ATR
â”‚   â”‚   â”œâ”€â”€ orderflow.py        # OBI calculation
â”‚   â”‚   â””â”€â”€ btc_health.py       # BTC state assessment
â”‚   â”‚
â”‚   â”œâ”€â”€ trading/
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ strategy.py         # Entry/Exit scoring
â”‚   â”‚   â”œâ”€â”€ dca_manager.py      # DCA layers + WAIT MODE
â”‚   â”‚   â”œâ”€â”€ profit_router.py    # BTC/PAXG distribution
â”‚   â”‚   â”œâ”€â”€ position_manager.py # Max 3 positions + Queue [NEW V10.8]
â”‚   â”‚   â””â”€â”€ refuel.py           # Emergency PAXG liquidation
â”‚   â”‚
â”‚   â”œâ”€â”€ security/               # [NEW V10.8.2]
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ spread_filter.py    # Abnormal spread detection
â”‚   â”‚   â”œâ”€â”€ wick_filter.py      # Fake candle neutralizer
â”‚   â”‚   â”œâ”€â”€ volume_sanity.py    # Wash trade detection
â”‚   â”‚   â””â”€â”€ order_lock.py       # Race condition prevention
â”‚   â”‚
â”‚   â””â”€â”€ watchdog/
â”‚       â”œâ”€â”€ __init__.py
â”‚       â””â”€â”€ belle.py            # 60s health monitor + 30min heartbeat
â”‚
â”œâ”€â”€ data/
â”‚   â”œâ”€â”€ candles_cache/          # Cached OHLCV data
â”‚   â”œâ”€â”€ state_backups/          # Rolling 10 backups [NEW V10.8.2]
â”‚   â””â”€â”€ logs/                   # Daily log files
â”‚
â””â”€â”€ context_backups/            # Auto-generated context snapshots

================================================================================
SECTION 9 â€” REPORTING (trades.xlsx)
================================================================================

[9.1] Trade Log Columns:

    +-----+-------------------+------------------------------------------------+
    | #   | Column Name       | Description                                    |
    +-----+-------------------+------------------------------------------------+
    | 1   | trade_id          | Unique identifier (UUID)                       |
    | 2   | timestamp         | Trade execution time                           |
    | 3   | symbol            | Trading pair (e.g., SOLUSDT)                   |
    | 4   | side              | BUY or SELL                                    |
    | 5   | entry_price       | Average entry price                            |
    | 6   | exit_price        | Exit price (if closed)                         |
    | 7   | quantity          | Amount traded                                  |
    | 8   | pnl_usdt          | Profit/Loss in USDT                            |
    | 9   | pnl_percent       | Profit/Loss percentage                         |
    | 10  | dca_layer         | DCA level used (0-3)                           |
    | 11  | profit_destination| Where profit went (BTC/PAXG/BOTH)              |
    | 12  | btc_health_state  | BTC state at profit time                       |
    | 13  | paxg_action       | HOLD/REFUEL/NONE                               |
    | 14  | emergency_refuel  | TRUE/FALSE (was PAXG used for rescue)          |
    | 15  | fees_paid         | Total fees in USDT                             |
    | 16  | duration_minutes  | Time from entry to exit                        |
    | 17  | score_at_entry    | Strategy score when entered                    |
    | 18  | queue_wait_time   | Minutes waited in queue (0 if immediate) [NEW] |
    | 19  | security_flags    | Any filters triggered (spread/wick/volume)[NEW]|
    | 20  | notes             | Auto-generated trade notes                     |
    +-----+-------------------+------------------------------------------------+

[9.2] Daily Summary Sheet:

    - Total trades executed
    - Win rate percentage
    - Net PnL (USDT)
    - BTC vault growth
    - PAXG vault growth
    - Max drawdown reached
    - API calls made
    - Queue utilization (signals queued vs executed) [NEW V10.8]
    - Security blocks count (spread/wick/volume) [NEW V10.8.2]

================================================================================
SECTION 10 â€” GLOBAL STOP PROTOCOL
================================================================================

[10.1] Activation Conditions (ANY triggers STOP):

    +-----+----------------------------------+----------------------------------+
    | #   | Condition                        | Detection Method                 |
    +-----+----------------------------------+----------------------------------+
    | 1   | BTC drops > 8% in 4 hours        | Price monitoring (1H candles)    |
    | 2   | Portfolio drawdown > 15%         | Real-time balance check          |
    | 3   | API failure > 60 seconds         | Health check timeout             |
    | 4   | Manual STOP command              | Telegram /stop command           |
    | 5   | Balance mismatch > 5%            | Local vs Exchange comparison     |
    | 6   | State file corruption            | Checksum validation [NEW V10.8.2]|
    +-----+----------------------------------+----------------------------------+

[10.2] STOP Actions:

    1. Cancel ALL open orders immediately
    2. Set system state to HALTED
    3. Send CRITICAL alert to Telegram
    4. Log all current positions and balances
    5. Clear WAITING_QUEUE [NEW V10.8]
    6. Require manual restart with confirmation

[10.3] Recovery Protocol:

    1. User sends /restart command
    2. System performs full health check
    3. Compares state.json with exchange data
    4. Validates state.json checksum [NEW V10.8.2]
    5. If mismatch found â†’ require manual resolution
    6. If clean â†’ resume in EXIT_ONLY mode for 1 hour
    7. After 1 hour with no issues â†’ resume NORMAL mode

================================================================================
SECTION 11 â€” SECURITY PROTOCOLS (HARDENED)
================================================================================

[11.1] Trading Mode Gates (MANDATORY PROGRESSION):

    +------------+------------------+-------------------------------------------+
    | Mode       | Duration         | Restrictions                              |
    +------------+------------------+-------------------------------------------+
    | PAPER      | Min 72 hours     | NO real orders, simulation only           |
    | LIVE_TEST  | Min 7 days       | Max 50 USDT total exposure                |
    | LIVE_FULL  | After approval   | Full capital with all safety checks       |
    +------------+------------------+-------------------------------------------+

    Mode Transition Rules:
    - PAPER â†’ LIVE_TEST: Requires 72h runtime + manual approval
    - LIVE_TEST â†’ LIVE_FULL: Requires 7 days + positive PnL + manual approval
    - Any mode can go back to PAPER instantly

[11.2] Hardware Kill Switch:

    Activation Triggers:
    - Internet disconnection > 30 seconds
    - API unresponsive > 60 seconds
    - System memory > 90%
    - Unexpected exception in main loop

    Kill Actions:
    - Immediately terminate all processes
    - Do NOT attempt order cancellation (may fail)
    - Write emergency state dump to disk
    - Send offline alert via backup channel (if possible)

[11.3] Request Rate Limiter:

    Configuration:
    - Hard limit: 25 requests per minute (below Nobitex 30)
    - Minimum spacing: 2.5 seconds between requests
    - Queue overflow action: REJECT and ALERT

    Implementation:
    - Token bucket algorithm
    - Separate queues for: Orders, Balance, Market Data
    - Priority: Orders > Balance > Market Data

[11.4] Balance Sanity Checker:

    Pre-Order Verification:
    1. Fetch fresh balance from exchange
    2. Compare with local state.json
    3. If difference > 5% â†’ HALT + ALERT
    4. If difference 1-5% â†’ WARNING + Continue
    5. If difference < 1% â†’ OK

    Post-Order Verification:
    1. Wait 3 seconds after order
    2. Fetch updated balance
    3. Verify expected change occurred
    4. Log discrepancy if any

[11.5] Maximum Drawdown Protection:

    Threshold: 15% of initial portfolio value

    Monitoring:
    - Check every 60 seconds (via Watchdog)
    - Calculate: (Initial_Value - Current_Value) / Initial_Value

    Action on Breach:
    1. Immediate GLOBAL STOP
    2. Cancel all open orders
    3. Send CRITICAL alert with full report
    4. Require manual intervention to restart
    5. Log incident with timestamp and portfolio snapshot

[11.6] API Key Security:

    Storage:
    - .env file with 600 permissions (owner read/write only)
    - Never logged, never in error messages
    - Never committed to git (.gitignore enforced)

    Runtime:
    - Load once at startup
    - Store in memory only
    - Clear on shutdown

    Exchange Panel Settings [NEW V10.8.2]:
    - [X] IP Whitelist: SERVER_IP_ONLY
    - [X] Permissions: Trade + Read
    - [ ] Withdrawal: DISABLED (CRITICAL!)

[11.7] Audit Trail:

    All Actions Logged:
    - Every API request with timestamp
    - Every order placed/cancelled
    - Every state change
    - Every alert sent
    - Every mode transition
    - Every security filter trigger [NEW V10.8.2]

    Log Retention:
    - Daily rotation
    - 30 days local storage
    - Critical events: permanent

[11.8] Anti-Manipulation Filters [NEW V10.8.2]:

    [11.8.1] Spread Filter:
        MAX_SPREAD_PERCENT = 0.005 (0.5%)
        
        Logic:
            spread = (best_ask - best_bid) / best_bid
            IF spread > MAX_SPREAD_PERCENT:
                BLOCK entry
                LOG "Abnormal spread detected"
                ALERT (WARNING)

    [11.8.2] Wick Filter:
        Logic:
            candle_body = |close - open|
            candle_wick = (high - low) - candle_body
            IF candle_wick > 3 Ã— candle_body:
                IGNORE current candle
                USE previous candle for indicators
                LOG "Abnormal wick ignored"

    [11.8.3] Volume Sanity Check:
        Logic:
            avg_volume = SMA(volume, 20)
            IF current_volume > 10 Ã— avg_volume:
                FLAG as SUSPICIOUS
                REDUCE position size by 50%
                ALERT (INFO)

    [11.8.4] Order Duplication Lock:
        ORDER_LOCK = GLOBAL MUTEX
        MIN_ORDER_INTERVAL = 5 seconds
        
        Logic:
            BEFORE placing order:
                ACQUIRE ORDER_LOCK
                IF last_order_time < 5 seconds:
                    CANCEL placement
                    LOG "Duplicate order prevented"
            AFTER placement:
                RELEASE ORDER_LOCK

    [11.8.5] State File Protection:
        - Backup state.json every 5 minutes
        - Keep last 10 backups (rolling)
        - Validate checksum on load
        - AUTO-RESTORE if corruption detected
        - Start in EXIT_ONLY mode after restore

    [11.8.6] Security Boundary Principle:
        Security filters NEVER:
            - Modify strategy logic
            - Modify scoring weights
            - Force entries
        
        They ONLY:
            - BLOCK execution
            - REDUCE size
            - DELAY execution
        
        Strategy purity is preserved.

================================================================================
SECTION 12 â€” CONFIGURATION REFERENCE (config.py)
================================================================================

[12.1] Capital Settings:

    # PERCENTAGE-BASED (V10.8+)
    MIN_CAPITAL_USDT = 500
    
    ALLOCATION = {
        "SOL": 0.25,
        "BNB": 0.20,
        "XRP": 0.15,
        "AVAX": 0.10,
        "LINK": 0.10,
        "USDT": 0.10,
        "BTC": 0.05,
        "PAXG": 0.05
    }

[12.2] Trading Parameters:

    MIN_ORDER_USDT = 12
    ENTRY_SCORE_THRESHOLD = 70
    TAKE_PROFIT_MIN = 0.015
    TAKE_PROFIT_MAX = 0.030
    TRAILING_ACTIVATION = 0.01
    
    # Order Execution (V10.8.1+)
    ORDER_TYPE_PRIMARY = "limit"
    LIMIT_ORDER_OFFSET = 0.001  # 0.1%
    LIMIT_ORDER_TIMEOUT = 30   # seconds
    ORDER_TYPE_FALLBACK = "market"

[12.3] Position Management (V10.8+):

    MAX_CONCURRENT_POSITIONS = 3
    QUEUE_MAX_SIZE = 5
    QUEUE_EXPIRY_HOURS = 4
    QUEUE_PRICE_TOLERANCE = 0.01  # 1%

[12.4] Entry Scoring Weights (V10.8.1+):

    SCORE_WEIGHTS = {
        "technical": 35,    # RSI + BB
        "obi": 15,          # Order Book Imbalance (reduced)
        "volume": 25,       # Volume spike
        "momentum": 25      # Green candle
    }

[12.5] DCA Settings:

    DCA_LAYERS = {
        1: {"trigger": -0.03, "add_percent": 0.50},
        2: {"trigger": -0.06, "add_percent": 0.75},
        3: {"trigger": -0.10, "add_percent": 1.00}
    }

[12.6] Safety Settings:

    MAX_DRAWDOWN_PERCENT = 0.15
    API_TIMEOUT_SECONDS = 10
    KILL_SWITCH_TIMEOUT = 60
    BALANCE_MISMATCH_HALT = 0.05
    BALANCE_MISMATCH_WARN = 0.01


[12.7] Rate Limiting:

    REQUESTS_PER_MINUTE = 25
    MIN_REQUEST_SPACING = 2.5  # seconds

[12.8] Profit Router:

    BTC_HEALTH_THRESHOLDS = {
        "STRONG": {"rsi_min": 60, "above_ema": True, "macd_positive": True},
        "WEAK": {"rsi_max": 40, "below_ema": True, "macd_negative": True}
    }
    
    PROFIT_SPLIT = {
        "STRONG": {"btc": 0.80, "paxg": 0.20},
        "NEUTRAL": {"btc": 0.50, "paxg": 0.50},
        "WEAK": {"btc": 0.20, "paxg": 0.80}
    }

[12.9] Emergency Refuel:

    PAXG_MAX_SELL_PERCENT = 0.50
    REFUEL_COOLDOWN_HOURS = 24
    USDT_LOW_THRESHOLD = 0.20  # 20% of slot capital

[12.10] Telegram:

    TELEGRAM_BOT_TOKEN = "from .env"
    TELEGRAM_CHAT_ID = "from .env"
    TELEGRAM_PROXY_HOST = "127.0.0.1"
    TELEGRAM_PROXY_PORT = 1080
    HEARTBEAT_INTERVAL_MINUTES = 30  # [NEW V10.8]

[12.11] Nobitex:

    NOBITEX_API_KEY = "from .env"
    NOBITEX_BASE_URL = "https://api.nobitex.ir"
    TAKER_FEE = 0.0035
    MAKER_FEE = 0.0025

[12.12] Security Filters [NEW V10.8.2]:

    MAX_SPREAD_PERCENT = 0.005        # 0.5%
    WICK_BODY_RATIO_MAX = 3.0         # wick > 3x body = ignore
    VOLUME_SPIKE_MULTIPLIER = 10      # > 10x avg = suspicious
    MIN_ORDER_INTERVAL_SECONDS = 5    # anti-duplicate
    STATE_BACKUP_INTERVAL_MINUTES = 5
    STATE_BACKUP_KEEP_COUNT = 10

================================================================================
SECTION 13 â€” WATCHDOG MODULE (BELLE)
================================================================================

[13.1] Core Responsibilities:

    +-----+----------------------------------+----------------------------------+
    | #   | Task                             | Interval                         |
    +-----+----------------------------------+----------------------------------+
    | 1   | Health Check (API ping)          | Every 60 seconds                 |
    | 2   | Balance Verification             | Every 60 seconds                 |
    | 3   | Drawdown Calculation             | Every 60 seconds                 |
    | 4   | BTC Crash Detection              | Every 60 seconds                 |
    | 5   | State File Integrity             | Every 60 seconds [NEW V10.8.2]   |
    | 6   | Heartbeat Telegram               | Every 30 minutes [NEW V10.8]     |
    +-----+----------------------------------+----------------------------------+

[13.2] Health Check Flow:

    EVERY 60 SECONDS:
        1. Ping Nobitex API (GET /v2/options)
        2. IF timeout > 10s:
            - Increment failure_count
        3. IF failure_count >= 3:
            - Trigger HARDWARE KILL SWITCH
        4. IF success:
            - Reset failure_count to 0

[13.3] Heartbeat Message Format [NEW V10.8]:

    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    ğŸ«€ OCEAN HUNTER HEARTBEAT
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    â° Time: 2025-12-30 14:30:00
    ğŸ“Š Mode: LIVE_FULL
    ğŸ’° Portfolio: $4,125.50 (+3.14%)
    ğŸ“ˆ Open Positions: 2/3
    ğŸ”„ Queue: 1 signal waiting
    âš¡ BTC Health: NEUTRAL
    ğŸ›¡ï¸ Security: ALL CLEAR
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

[13.4] Alert Priority Levels:

    +----------+------------------+----------------------------------------+
    | Level    | Telegram Icon    | Use Case                               |
    +----------+------------------+----------------------------------------+
    | INFO     | â„¹ï¸               | Trade executed, profit taken           |
    | WARNING  | âš ï¸               | Spread high, volume spike              |
    | CRITICAL | ğŸš¨               | Drawdown breach, API failure           |
    | FATAL    | â˜ ï¸               | Kill switch activated                  |
    +----------+------------------+----------------------------------------+
================================================================================
SECTION 14 â€” EXECUTION FLOW (MAIN LOOP)
================================================================================

[14.1] Startup Sequence:

    1. Load .env (API keys)
    2. Load config.py (parameters)
    3. Load/Create state.json
    4. Validate state checksum [NEW V10.8.2]
    5. Verify API connectivity
    6. Sync balances with exchange
    7. Check trading mode (PAPER/LIVE_TEST/LIVE_FULL)
    8. Start Watchdog thread
    9. Send startup alert to Telegram
    10. Enter main loop

[14.2] Main Loop (Every 60 Seconds):

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                         MAIN LOOP START                             â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ STEP 1: Check System State                                          â”‚
    â”‚   - IF HALTED â†’ Skip to END                                         â”‚
    â”‚   - IF EXIT_ONLY â†’ Skip entry logic                                 â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ STEP 2: Fetch Market Data                                           â”‚
    â”‚   - Get OHLCV for all 5 altcoins (M15)                              â”‚
    â”‚   - Get BTC OHLCV (1H) for health check                             â”‚
    â”‚   - Get order books for OBI                                         â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ STEP 3: Security Filters [NEW V10.8.2]                              â”‚
    â”‚   - Check spread for each symbol                                    â”‚
    â”‚   - Check wick anomaly on latest candle                             â”‚
    â”‚   - Check volume sanity                                             â”‚
    â”‚   - IF ANY FILTER TRIGGERED â†’ Flag symbol, reduce/block             â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ STEP 4: Calculate Indicators                                        â”‚
    â”‚   - RSI(14), EMA(20), BB(20,2), MACD(12,26,9)                       â”‚
    â”‚   - OBI from order book                                             â”‚
    â”‚   - Volume SMA(20)                                                  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ STEP 5: Assess BTC Health                                           â”‚
    â”‚   - Determine STRONG / NEUTRAL / WEAK                               â”‚
    â”‚   - IF WEAK â†’ Block new entries [NEW V10.8.1]                       â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ STEP 6: Score Entry Candidates                                      â”‚
    â”‚   - For each altcoin without open position:                         â”‚
    â”‚     - Calculate entry score (Technical + OBI + Volume + Momentum)   â”‚
    â”‚     - Weights: 35 + 15 + 25 + 25 = 100 [V10.8.1]                    â”‚
    â”‚     - IF score >= 70 â†’ Add to candidates                            â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ STEP 7: Position Management [NEW V10.8]                             â”‚
    â”‚   - Count open positions                                            â”‚
    â”‚   - IF open_count < 3 â†’ Execute best candidate                      â”‚
    â”‚   - IF open_count >= 3 â†’ Add to WAITING_QUEUE                       â”‚
    â”‚   - Process queue (check expiry, price tolerance)                   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ STEP 8: Execute Entry (If Approved)                                 â”‚
    â”‚   - Acquire ORDER_LOCK [NEW V10.8.2]                                â”‚
    â”‚   - Place LIMIT order with 0.1% offset [V10.8.1]                    â”‚
    â”‚   - Wait up to 30 seconds for fill                                  â”‚
    â”‚   - IF not filled â†’ Cancel and place MARKET order                   â”‚
    â”‚   - Release ORDER_LOCK                                              â”‚
    â”‚   - Update state.json                                               â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ STEP 9: Manage Open Positions                                       â”‚
    â”‚   - For each open position:                                         â”‚
    â”‚     - Check exit conditions (TP / Trailing)                         â”‚
    â”‚     - Check DCA triggers                                            â”‚
    â”‚     - Execute DCA if triggered (with PAXG refuel if needed)         â”‚
    â”‚     - Execute exit if profit target hit                             â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ STEP 10: Profit Distribution                                        â”‚
    â”‚   - IF position closed with profit:                                 â”‚
    â”‚     - Route profit based on BTC health state                        â”‚
    â”‚     - Execute BTC/PAXG purchases                                    â”‚
    â”‚     - Return principal to USDT pool                                 â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ STEP 11: State Persistence                                          â”‚
    â”‚   - Save state.json                                                 â”‚
    â”‚   - Backup if 5 minutes passed [NEW V10.8.2]                        â”‚
    â”‚   - Log trade to trades.xlsx                                        â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                         MAIN LOOP END                               â”‚
    â”‚                    (Wait 60 seconds, repeat)                        â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

================================================================================
SECTION 15 â€” TESTING PROTOCOL
================================================================================

[15.1] Unit Tests Required:

    +-----+---------------------------+--------------------------------------------+
    | #   | Module                    | Test Cases                                 |
    +-----+---------------------------+--------------------------------------------+
    | 1   | indicators.py             | RSI, EMA, BB, MACD, ATR accuracy           |
    | 2   | orderflow.py              | OBI correctness vs raw order book          |
    | 3   | btc_health.py             | STRONG / NEUTRAL / WEAK classification     |
    | 4   | strategy.py               | Entry score calculation (weighted)         |
    | 5   | dca_manager.py            | DCA triggers, WAIT MODE logic              |
    | 6   | profit_router.py          | Profit split consistency                   |
    | 7   | refuel.py                 | Emergency Refuel conditions                |
    | 8   | rate_limiter.py           | Token bucket + spacing enforcement         |
    | 9   | state_manager.py          | Save / load / checksum / restore           |
    | 10  | security_filters/*        | Spread, Wick, Volume sanity [V10.8.2]      |
    +-----+---------------------------+--------------------------------------------+

[15.2] Integration Tests:

    1. Full lifecycle trade:
        Entry â†’ DCA L1 â†’ DCA L2 â†’ Exit â†’ Profit Split
    2. Emergency Refuel path (PAXG in profit)
    3. WAIT MODE activation (PAXG in loss)
    4. Global Stop activation + recovery
    5. Queue behavior:
        - Add when full
        - Expiry (4h)
        - Price deviation > 2%
    6. API failure simulation
    7. State corruption & auto-restore [NEW V10.8.2]

[15.3] Paper Trading Requirements:

    - Minimum runtime: 72 continuous hours
    - Minimum simulated trades: 10
    - Must include:
        â€¢ One DCA scenario
        â€¢ One trailing exit
        â€¢ One profit routing to BTC
        â€¢ One profit routing to PAXG
    - Must trigger at least:
        â€¢ One security filter event
        â€¢ One heartbeat log
================================================================================
SECTION 16 â€” DEPLOYMENT CHECKLIST
================================================================================

[16.1] Pre-Deployment (MANDATORY):

    [ ] Nobitex API key with READ + TRADE only
    [ ] Withdrawal permission DISABLED
    [ ] IP Whitelist enabled (server IP only) [V10.8.2]
    [ ] .env permissions set to 600
    [ ] .gitignore blocks .env and state.json
    [ ] All unit tests PASSED
    [ ] Paper mode completed (â‰¥72h)
    [ ] Telegram bot tested (alerts + heartbeat)
    [ ] Server timezone = UTC
    [ ] Disk space > 20% free
    [ ] CPU/RAM stable under load

[16.2] Mode Progression (STRICT):

    PAPER
      â””â”€ after 72h + approval â†’
    LIVE_TEST (Max exposure: 50 USDT)
      â””â”€ after 7 days + positive PnL â†’
    LIVE_FULL

[16.3] Go-Live Sequence:

    1. Set MODE = "LIVE_TEST"
    2. Start system
    3. Confirm startup alert
    4. Monitor logs + Telegram closely
    5. Review trades.xlsx daily
    6. Promote to LIVE_FULL only after approval

[16.4] Rollback Plan:

    IF unexpected behavior:
        - Switch MODE to PAPER
        - Disable API key
        - Review logs + state backups
        - Restart only after root cause identified
================================================================================
SECTION 17 â€” FINAL LOCK & ARCHITECTURE STATUS
================================================================================

Architecture Name:
    OCEAN HUNTER â€” COMPLETE SECURE ARCHITECTURE

Version:
    V10.8.2

Trading Type:
    SPOT â€” NO LEVERAGE â€” NO STOP LOSS

Risk Philosophy:
    â€¢ Capital preservation > profit speed
    â€¢ BTC & PAXG = long-term vaults
    â€¢ USDT = operational fuel only

Security Philosophy:
    â€¢ Assume exchange misbehavior
    â€¢ Assume network failure
    â€¢ Assume software bugs
    â€¢ Protect capital above all

Status:
    âœ… ARCHITECTURE COMPLETE
    âœ… SECURITY HARDENED
    âœ… READY FOR IMPLEMENTATION
    âœ… FINAL â€” NO FURTHER CHANGES WITHOUT VERSION BUMP

================================================================================
ARCHITECTURE REFERENCE CODE:
REF-ARCH-V10.8.2-FINAL-LOCK-610
===================================================================================== SECTION 17 â€” TEST FRAMEWORK ARCHITECTURE [V10.8.2]
[17.1] FRAMEWORK OVERVIEW:

Scenarios (JSON) â”€â”€â”

Candles (CSV) â”€â”€â”€â”€â”€â”¼â”€â”€â–¶ TestSimulatorProvider â”€â”€â–¶ Engine â”€â”€â–¶ Reporter

OrderBooks (JSON) â”€â”¤

Wallets (JSON) â”€â”€â”€â”€â”˜

Config Switch: DATA_MODE = â€œLIVEâ€ | â€œTESTâ€

[17.2] DATA PROVIDER INTERFACE (IDataProvider):

Methods:

get_candles(symbol, timeframe, count) â†’ List[Candle]

get_orderbook(symbol) â†’ OrderBook

get_balance(asset) â†’ Balance

get_all_balances() â†’ Dict[str, Balance]

place_order(symbol, side, amount, order_type, price) â†’ OrderResult

cancel_order(order_id) â†’ bool

get_ticker(symbol) â†’ Ticker

Implementations:

NobitexLiveProvider (modules/network/nobitex.py)

Data Source: Nobitex REST API
Orders: Real execution
Used When: DATA_MODE = â€œLIVEâ€
TestSimulatorProvider (tests/providers/test_provider.py)

Data Source: CSV + JSON files
Orders: Virtual wallet update
Used When: DATA_MODE = â€œTESTâ€
[17.3] TEST CONFIGURATION (config.py):

DATA_MODE = â€œLIVEâ€

TEST_CONFIG = {

â€œscenario_fileâ€: â€œSC-001-basic-entry-exit.jsonâ€,

â€œcandle_speedâ€: â€œINSTANTâ€,

â€œenable_loggingâ€: True,

â€œoutput_formatâ€: [â€œJSONâ€, â€œEXCELâ€],

â€œtelegram_reportâ€: True

}

Candle Speed Options:

INSTANT = Process all candles immediately (batch test)

FAST = 1 second per candle (visual debugging)

REALTIME = 15 minutes per M15 candle (realistic simulation)

[17.4] DIRECTORY STRUCTURE:

tests/

â”œâ”€â”€ init.py

â”œâ”€â”€ conftest.py

â”œâ”€â”€ run_tests.py

â”œâ”€â”€ data/

â”‚ â”œâ”€â”€ candles/

â”‚ â”‚ â”œâ”€â”€ SOL_M15.csv, SOL_1H.csv

â”‚ â”‚ â”œâ”€â”€ BNB_M15.csv, BNB_1H.csv

â”‚ â”‚ â”œâ”€â”€ XRP_M15.csv, XRP_1H.csv

â”‚ â”‚ â”œâ”€â”€ AVAX_M15.csv, AVAX_1H.csv

â”‚ â”‚ â”œâ”€â”€ LINK_M15.csv, LINK_1H.csv

â”‚ â”‚ â”œâ”€â”€ BTC_1H.csv, PAXG_1H.csv

â”‚ â”œâ”€â”€ orderbooks/

â”‚ â”‚ â”œâ”€â”€ SOL.json, BNB.json, XRP.json, AVAX.json, LINK.json

â”‚ â”œâ”€â”€ scenarios/

â”‚ â”‚ â”œâ”€â”€ SC-001 to SC-015 (see 17.7)

â”‚ â””â”€â”€ wallets/

â”‚ â””â”€â”€ initial_wallet_v10.8.2.json

â”œâ”€â”€ providers/

â”‚ â”œâ”€â”€ init.py

â”‚ â”œâ”€â”€ test_provider.py

â”‚ â”œâ”€â”€ virtual_wallet.py

â”‚ â”œâ”€â”€ candle_player.py

â”‚ â””â”€â”€ order_simulator.py

â”œâ”€â”€ runners/

â”‚ â”œâ”€â”€ init.py

â”‚ â”œâ”€â”€ scenario_runner.py

â”‚ â”œâ”€â”€ batch_runner.py

â”‚ â””â”€â”€ interactive_runner.py

â”œâ”€â”€ reporters/

â”‚ â”œâ”€â”€ init.py

â”‚ â”œâ”€â”€ json_reporter.py

â”‚ â”œâ”€â”€ excel_reporter.py

â”‚ â””â”€â”€ telegram_reporter.py

â””â”€â”€ outputs/

â””â”€â”€ .gitkeep

[17.5] VIRTUAL WALLET SYSTEM:

Purpose: Track simulated balances during test scenarios

Initialization: Load from tests/data/wallets/initial_wallet_v10.8.2.json

State Structure:

{

â€œUSDTâ€: {â€œavailableâ€: 400, â€œlockedâ€: 0},

â€œSOLâ€: {â€œavailableâ€: 0, â€œlockedâ€: 0, â€œavg_priceâ€: 0},

â€œBNBâ€: {â€œavailableâ€: 0, â€œlockedâ€: 0, â€œavg_priceâ€: 0},

â€œXRPâ€: {â€œavailableâ€: 0, â€œlockedâ€: 0, â€œavg_priceâ€: 0},

â€œAVAXâ€: {â€œavailableâ€: 0, â€œlockedâ€: 0, â€œavg_priceâ€: 0},

â€œLINKâ€: {â€œavailableâ€: 0, â€œlockedâ€: 0, â€œavg_priceâ€: 0},

â€œBTCâ€: {â€œavailableâ€: 0.005, â€œlockedâ€: 0, â€œavg_priceâ€: 42000},

â€œPAXGâ€: {â€œavailableâ€: 0.08, â€œlockedâ€: 0, â€œavg_priceâ€: 2500}

}

Operations:

BUY(symbol, amount_usdt, price):

Check USDT available >= amount_usdt
Calculate quantity = amount_usdt / price
Apply fee (0.35%)
Deduct USDT
Add to symbol balance
Update avg_price (weighted average)
SELL(symbol, quantity, price):

Check symbol available >= quantity
Calculate received_usdt = quantity * price
Apply fee (0.35%)
Deduct from symbol
Add to USDT balance
[17.6] SCENARIO FILE FORMAT:

{

â€œscenario_idâ€: â€œSC-001â€,

â€œnameâ€: â€œBasic Entry and Exitâ€,

â€œdescriptionâ€: â€œTest entry at score 75, exit at 2% profitâ€,

â€œduration_candlesâ€: 100,

â€œinitial_walletâ€: â€œinitial_wallet_v10.8.2.jsonâ€,

â€œcandle_filesâ€: {â€œSOLâ€: â€œSOL_M15.csvâ€, â€œBTCâ€: â€œBTC_1H.csvâ€},

â€œorderbook_filesâ€: {â€œSOLâ€: â€œSOL.jsonâ€},

â€œexpected_resultsâ€: {

â€œtotal_tradesâ€: 1,

â€œwinning_tradesâ€: 1,

â€œfinal_usdt_minâ€: 400,

â€œbtc_vault_increasedâ€: true

},

â€œassertionsâ€: [

{â€œtypeâ€: â€œentry_triggeredâ€, â€œsymbolâ€: â€œSOLâ€, â€œcandle_indexâ€: 15},

{â€œtypeâ€: â€œexit_triggeredâ€, â€œsymbolâ€: â€œSOLâ€, â€œcandle_indexâ€: 45},

{â€œtypeâ€: â€œprofit_routedâ€, â€œdestinationâ€: â€œBTCâ€}

]

}

[17.7] TEST SCENARIOS (15 CORE):

SC-001: Basic Entry/Exit (score threshold + take profit)

SC-002: DCA Layer 1 (-3% trigger)

SC-003: DCA Layer 2 (-6% trigger)

SC-004: DCA Layer 3 (-10% trigger)

SC-005: Emergency Refuel (PAXG in profit)

SC-006: WAIT MODE (PAXG in loss)

SC-007: Trailing Exit (activate after +1%)

SC-008: BTC Strong (80/20 split)

SC-009: BTC Weak (20/80 split + entry block)

SC-010: Global Stop (BTC -8% in 4h)

SC-011: Spread Filter (>0.5% rejection)

SC-012: Wick Filter (wick > 3x body)

SC-013: Volume Sanity (>10x avg rejection)

SC-014: Queue Full (3 positions + queue)

SC-015: Max Positions (limit enforcement)

[17.8] CANDLE CSV FORMAT:

timestamp,open,high,low,close,volume,scenario_tag

1704067200,100.5,102.3,99.8,101.2,15000,ENTRY_SIGNAL

1704068100,101.2,103.5,100.9,102.8,18000,NORMAL

1704069000,102.8,103.0,98.5,99.2,25000,DCA_L1

Scenario Tags:

ENTRY_SIGNAL, DCA_L1, DCA_L2, DCA_L3, EXIT_PROFIT

EXIT_TRAILING, REFUEL_TRIGGER, WAIT_MODE, NORMAL

[17.9] ORDERBOOK JSON FORMAT:

{

â€œsymbolâ€: â€œSOLâ€,

â€œtimestampâ€: 1704067200,

â€œbidsâ€: [[100.5, 150], [100.4, 200], â€¦],

â€œasksâ€: [[100.6, 120], [100.7, 180], â€¦],

â€œspread_percentâ€: 0.001,

â€œobiâ€: 0.15

}

[17.10] TEST REPORTER OUTPUT:

JSON (tests/outputs/report_SC-001_YYYYMMDD_HHMM.json):

{

â€œscenario_idâ€: â€œSC-001â€,

â€œstatusâ€: â€œPASSâ€,

â€œduration_secondsâ€: 2.5,

â€œtrades_executedâ€: 1,

â€œassertions_passedâ€: 3,

â€œassertions_failedâ€: 0,

â€œfinal_walletâ€: {â€¦},

â€œtrade_logâ€: [â€¦]

}

Excel (tests/outputs/report_SC-001_YYYYMMDD_HHMM.xlsx):

Sheet 1: Summary (Pass/Fail, Duration, Stats)

Sheet 2: Trade Log (All executed trades)

Sheet 3: Wallet History (Balance changes over time)

Sheet 4: Assertion Results (Each assertion detail)

Telegram Summary:

âœ… Test Report: SC-001

Status: PASS | Trades: 1 | Win Rate: 100%

Assertions: 3/3 passed | Duration: 2.5s

[17.11] BATCH EXECUTION:

Command: python tests/run_tests.py --all

Process:

Load all scenarios from tests/data/scenarios/
Execute each scenario sequentially
Collect results
Generate combined report
Send summary to Telegram
Combined Report:

{

â€œtotal_scenariosâ€: 15,

â€œpassedâ€: 14,

â€œfailedâ€: 1,

â€œfailed_scenariosâ€: [â€œSC-012-wick-filterâ€],

â€œtotal_durationâ€: 45.2,

â€œtimestampâ€: â€œ2026-01-04T12:00:00Zâ€

}

[17.12] INTEGRATION WITH SECTION 15:

Unit Tests (Section 15.1):

Use TestSimulatorProvider for isolated module testing
Mock specific scenarios per module
Integration Tests (Section 15.2):

Run full scenarios (SC-001 to SC-015)
Validate complete trade lifecycle
Paper Trading (Section 15.3):

Extended scenario runs (72h equivalent data)
Must pass all 15 scenarios before LIVE_TEST
Progression Gate:

All 15 scenarios PASS â†’ Paper Mode OK â†’ LIVE_TEST eligible

================================================================================ END OF SECTION 17 â€” TEST FRAMEWORK
